<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Title -->
    <title>System Tables</title>

    <!-- Styles -->
    @Styles.Render("~/Content/css")
</head>
<body>
    <!-- Header -->
    @Html.Partial("HomeHeader")

    <section class="software-section">
        <div class="container">
            @Html.Partial("SoftwareMenu")
            <br /><br />
            <div class="panel panel-default">
                <div class="panel-heading">
                    <table style="width: 100%">
                        <tr>
                            <td>
                                <h4><i class="fa fa-table fa-fw"></i> System Tables</h4>
                            </td>
                            <td align="right">
                                <button class="btn btn-danger" id="btnClose" onclick="window.location = '/Software'">
                                    <i class="fa fa-close fa-fw"></i> Close
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="panel-body">
                    <ul id="myTab" class="nav nav-tabs">
                        <li class="active">
                            <a href="#LoanTypes" data-toggle="tab" id="LoanTypesTab">
                                Loan Types
                            </a>
                        </li>
                        <li>
                            <a href="#Requirements" data-toggle="tab" id="RequirementsTab">
                                Requirements
                            </a>
                        </li>
                        <li>
                            <a href="#ExpenseTypes" data-toggle="tab" id="expenseTypesTab">
                                Expense Types
                            </a>
                        </li>
                        <li>
                            <a href="#Accounts" data-toggle="tab" id="accountTab">
                                Accounts
                            </a>
                        </li>
                    </ul>
                    <br />
                    <div id="myTabContent" class="tab-content">
                        <div class="tab-pane fade in active" id="LoanTypes">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <table style="width: 100%">
                                        <tr>
                                            <td>
                                                <div class="input-group">
                                                    <span class="input-group-addon"><i class="fa fa-search fa-fw"></i> </span>
                                                    <input type="text" id="searchLoanTypes" class="form-control" placeholder="Search" />
                                                </div>
                                            </td>
                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                            <td align="right">
                                                <button class="btn btn-primary" id="btnAddLoanTypes" onclick="btnAddLoanTypesOnclick()">
                                                    <i class="fa fa-plus fa-fw"></i>&nbsp; Add
                                                </button>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="panel-body">
                                    <div id="LoanTypesListFlexGrid" class="grid"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="Requirements">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <table style="width: 100%">
                                        <tr>
                                            <td>
                                                <div class="input-group">
                                                    <span class="input-group-addon"><i class="fa fa-search fa-fw"></i> </span>
                                                    <input type="text" id="searchRequirements" class="form-control" placeholder="Search" />
                                                </div>
                                            </td>
                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                            <td align="right">
                                                <button class="btn btn-primary" id="btnAddRequirements" onclick="btnAddRequirementsOnclick()">
                                                    <i class="fa fa-plus fa-fw"></i>&nbsp; Add
                                                </button>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="panel-body">
                                    <div id="RequirementsListFlexGrid" class="grid"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="Accounts">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <table style="width: 100%">
                                        <tr>
                                            <td>
                                                <div class="input-group">
                                                    <span class="input-group-addon"><i class="fa fa-search fa-fw"></i> </span>
                                                    <input type="text" id="searchAccounts" class="form-control" placeholder="Search" />
                                                </div>
                                            </td>
                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                            <td align="right">
                                                <button class="btn btn-primary" id="btnAddAccounts" onclick="btnAddAccountsOnclick()">
                                                    <i class="fa fa-plus fa-fw"></i>&nbsp; Add
                                                </button>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="panel-body">
                                    <div id="AccountsListFlexGrid" class="grid"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="ExpenseTypes">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <table style="width: 100%">
                                        <tr>
                                            <td>
                                                <div class="input-group">
                                                    <span class="input-group-addon"><i class="fa fa-search fa-fw"></i> </span>
                                                    <input type="text" id="searchExpenseTypes" class="form-control" placeholder="Search" />
                                                </div>
                                            </td>
                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                            <td align="right">
                                                <button class="btn btn-primary" id="btnAddExpenseTypes" onclick="btnAddExpenseTypesOnclick()">
                                                    <i class="fa fa-plus fa-fw"></i>&nbsp; Add
                                                </button>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="panel-body">
                                    <div id="ExpenseTypesListFlexGrid" class="grid"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    User security stamp
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p>Created by:</p>
                            <div style="padding-left: 10px;">
                                <i class="fa fa-key fa-fw"></i> <label id="stampCreatedBy">NA</label>
                                <br />
                                <small><i class="fa fa-calendar fa-fw"></i> &nbsp;<span id="stampCreatedDate">mm/dd/yyyy</span></small>
                            </div>
                            <br />
                        </div>
                        <div class="col-md-6">
                            <p>Updated by:</p>
                            <div style="padding-left: 10px;">
                                <i class="fa fa-key fa-fw"></i> <label id="stampUpdatedBy">NA</label>
                                <br />
                                <small><i class="fa fa-calendar fa-fw"></i> &nbsp;<span id="stampUpdatedDate">mm/dd/yyyy</span></small>
                            </div>
                            <br />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    @Html.Partial("HomeFooter")

    <!-- LoanTypes Detail Modal -->
    <div class="modal fade" id="LoanTypesEditDetailModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"> LoanType Detail</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>LoanType</label><br />
                        <input type="text" class="form-control requiredLoanTypes" id="loanTypeName" placeholder="LoanType" />
                    </div>
                    <div class="form-group">
                        <label>Description</label><br />
                        <textarea class="form-control requiredLoanTypes" rows="5" id="loanTypeDescription" placeholder="Description"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="btnSaveLoanTypes" onclick="saveLoanTypesOnclick()"><i class="fa fa-save fa-fw"></i> Save</button>
                    <button class="btn btn-danger" id="btnCloseLoanTypes" data-dismiss="modal"><i class="fa fa-close fa-fw"></i> Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete confirmation LoanTypes modal -->
    <div class="modal fade" id="deleteConfirmationLoanTypesModal" role="dialog">
        <div class="modal-dialog modal-sm">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete LoanTypes</h4>
                </div>
                <div class="modal-body">
                    Are you sure that you want to delete this LoanType?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="btnConfirmDeleteLoanTypes" onclick="btnConfirmDeleteLoanTypesOnclick()">Delete</button>
                    <button class="btn btn-default" id="btnCloseDeleteLoanTypesModal" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Requirements Detail Modal -->
    <div class="modal fade" id="RequirementsEditDetailModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"> Requirement Detail</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Requirement</label><br />
                        <input type="text" class="form-control requiredRequirements" id="requirementName" placeholder="Requirement" />
                    </div>
                    <div class="form-group">
                        <label>Description</label><br />
                        <textarea class="form-control requiredRequirements" rows="5" id="requirementDescription" placeholder="Description"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="btnSaveRequirements" onclick="saveRequirementsOnclick()"><i class="fa fa-save fa-fw"></i> Save</button>
                    <button class="btn btn-danger" id="btnCloseRequirements" data-dismiss="modal"><i class="fa fa-close fa-fw"></i> Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete confirmation Requirements modal -->
    <div class="modal fade" id="deleteConfirmationRequirementsModal" role="dialog">
        <div class="modal-dialog modal-sm">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Requirements</h4>
                </div>
                <div class="modal-body">
                    Are you sure that you want to delete this Requirement?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="btnConfirmDeleteRequirements" onclick="btnConfirmDeleteRequirementsOnclick()">Delete</button>
                    <button class="btn btn-default" id="btnCloseDeleteRequirementsModal" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Accounts Detail Modal -->
    <div class="modal fade" id="AccountsEditDetailModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"> Account Detail</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Account</label><br />
                        <input type="text" class="form-control requiredAccounts" id="accountName" placeholder="Requirement" />
                    </div>
                    <div class="form-group">
                        <label>Description</label><br />
                        <textarea class="form-control requiredAccounts" rows="5" id="accountDescription" placeholder="Description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Transaction Type</label><br />
                        <div id="transactionType"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="btnSaveAccounts" onclick="saveAccountsOnclick()"><i class="fa fa-save fa-fw"></i> Save</button>
                    <button class="btn btn-danger" id="btnCloseAccounts" data-dismiss="modal"><i class="fa fa-close fa-fw"></i> Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete confirmation  Accounts modal -->
    <div class="modal fade" id="deleteConfirmationAccountsModal" role="dialog">
        <div class="modal-dialog modal-sm">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Accounts</h4>
                </div>
                <div class="modal-body">
                    Are you sure that you want to delete this Account?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="btnConfirmDeleteAccounts" onclick="btnConfirmDeleteAccountsOnclick()">Delete</button>
                    <button class="btn btn-default" id="btnCloseDeleteAccountsModal" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Expense Type Detail Modal -->
    <div class="modal fade" id="expenseTypeEditDetailModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Expense Type Detail</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ExpenseType</label><br />
                        <input type="text" class="form-control requiredExpenseTypes" id="expenseTypeName" placeholder="Expense Type" />
                    </div>
                    <div class="form-group">
                        <label>Description</label><br />
                        <textarea type="text" rows="5" class="form-control requiredExpenseTypes" id="expenseTypeDescription" placeholder="Description"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="btnSaveExpenseTypes" onclick="saveExpenseTypesOnclick()"><i class="fa fa-save fa-fw"></i> Save</button>
                    <button class="btn btn-danger" id="btnCloseExpenseTypes" data-dismiss="modal"><i class="fa fa-close fa-fw"></i> Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- delete confirmation Expense Type modal -->
    <div class="modal fade" id="deleteConfirmationExpenseTypesModal" role="dialog">
        <div class="modal-dialog modal-sm">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Expense Type</h4>
                </div>
                <div class="modal-body">
                    Are you sure that you want to delete this Expense Type?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="btnConfirmDeleteExpenseTypes" onclick="btnConfirmDeleteExpenseTypesOnclick()">Delete</button>
                    <button class="btn btn-default" id="btnCloseDeleteExpenseTypesModal" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script type="text/javascript">
        // global variables
        var loanTypesCollectionView;
        var loanTypesFlexGrid;
        var loanTypeId = 0;
        var requirementsCollectionView;
        var requirementsFlexGrid;
        var requirementId = 0;
        var accountsCollectionView;
        var accountsFlexGrid;
        var accountId = 0;
        var cboArea;
        var expenseTypesCollectionView;
        var expenseTypesFlexGrid;

        // get Accounts
        function getAccountsList() {
            var Accounts = new wijmo.collections.ObservableArray;
            $.ajax({
                url: '/api/account/list',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (AccountsListResult) {
                    if (AccountsListResult.length > 0) {
                        for (i = 0; i < AccountsListResult.length; i++) {

                            var disabledButton = "disabled";
                            var canPerformActions = "@ViewData["CanPerformActions"]";
                            if (canPerformActions == 1) {
                                disabledButton = "";
                            }

                            Accounts.push({
                                EditButton: "<button class='btn btn-primary btn-xs btn-block' onclick='editAccountsOnclick()'" + disabledButton + "><i class='fa fa-edit fa-fw'></i> Edit</button>",
                                DeleteButton: "<button class='btn btn-danger btn-xs btn-block'  onclick='deleteAccountsOnclick()'" + disabledButton + "><i class='fa fa-trash fa-fw'></i> Delete</button>",
                                Id: AccountsListResult[i]["Id"],
                                Account: AccountsListResult[i]["Account"],
                                Description: AccountsListResult[i]["Description"],
                                AccountTransactionTypeId: AccountsListResult[i]["AccountTransactionTypeId"],
                                AccountTransactionType: AccountsListResult[i]["AccountTransactionType"],
                                CreatedByUserId: AccountsListResult[i]["CreatedByUserId"],
                                CreatedByUser: AccountsListResult[i]["CreatedByUser"],
                                CreatedDateTime: AccountsListResult[i]["CreatedDateTime"],
                                UpdatedByUserId: AccountsListResult[i]["UpdatedByUserId"],
                                UpdatedByUser: AccountsListResult[i]["UpdatedByUser"],
                                UpdatedDateTime: AccountsListResult[i]["UpdatedDateTime"]
                            });
                        }
                    }

                    NProgress.done();
                }
            });
            return Accounts;
        }

        var cboTransactionType;

        // get transaction
        function getTransactionType() {
            var transactionTypeArray = new Array();
            $.ajax({
                url: '/api/transactionType/list',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                data: {},
                success: function (transactionTypeResults) {
                    var disabled = true;
                    if (transactionTypeResults.length > 0) {
                        for (i = 0; i < transactionTypeResults.length; i++) {
                            transactionTypeArray.push({
                                Id: transactionTypeResults[i]["Id"],
                                TransactionType: transactionTypeResults[i]["TransactionType"],
                            });
                        }

                        disabled = false;
                    }

                    cboTransactionType.dispose();
                    cboTransactionType = new wijmo.input.ComboBox('#transactionType', {
                        disabled: disabled,
                        placeholder: "Select",
                        itemsSource: transactionTypeArray,
                        isEditable: false,
                        required: true,
                        displayMemberPath: "TransactionType",
                        selectedValuePath: "TransactionType"
                    });
                }
            });
        }

        // add new Accounts
        function btnAddAccountsOnclick() {
            $("#AccountsEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredAccounts').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            getTransactionType();

            document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveAccounts").prop("disabled", false);
            $("#btnCloseAccounts").prop("disabled", false);

            accountId = 0;
            document.getElementById("accountName").value = "NA";
            document.getElementById("accountDescription").value = "NA";
        }

        // edit   Accounts
        function editAccountsOnclick() {
            $("#AccountsEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredAccounts').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveAccounts").prop("disabled", false);
            $("#btnCloseAccounts").prop("disabled", false);

            accountsCollectionView.editItem(accountsCollectionView.currentItem);
            var accountCurrentEditItem = accountsCollectionView.currentEditItem;

            accountId = accountCurrentEditItem.Id;
            document.getElementById("accountName").value = accountCurrentEditItem.Account;
            document.getElementById("accountDescription").value = accountCurrentEditItem.Description;
            cboTransactionType.selectedValue = accountCurrentEditItem.AccountTransactionType;
        }

        // form input validation
        function inputValidationForAccounts() {
            var isValid = true;
            $('.requiredAccounts').each(function () {
                if ($.trim($(this).val()) == '') {
                    isValid = false;
                    $(this).css({
                        "border": "1px solid red"
                    });
                } else {
                    $(this).css({
                        "border": "",
                    });
                }
            });

            return isValid;
        }

        // save Accounts
        function saveAccountsOnclick() {
            if (inputValidationForAccounts()) {
                document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Saving";
                $("#btnSaveAccounts").prop("disabled", true);
                $("#btnCloseAccounts").prop("disabled", true);

                var AccountsObject = new Object();
                AccountsObject.Account = document.getElementById('accountName').value;
                AccountsObject.Description = document.getElementById('accountDescription').value;
                AccountsObject.AccountTransactionTypeId = cboTransactionType.selectedItem["Id"];
                var AccountsData = JSON.stringify(AccountsObject);

                console.log(cboTransactionType.selectedItem["Id"]);

                if (accountId == 0) {
                    $.ajax({
                        type: "POST",
                        url: '/api/account/add',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: AccountsData,
                        statusCode: {
                            200: function () {
                                toastr.success("Save Successful");

                                $("#AccountsEditDetailModal").modal("hide");

                                accountsCollectionView = new wijmo.collections.CollectionView(getAccountsList());
                                accountsCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchAccounts').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    accountsCollectionView.refresh();
                                });

                                accountsCollectionView.filter = function (item) {
                                    return !filterText || (item.Account.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                accountsCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateAccountsStampSecurity();
                                });

                                // Flex Grid
                                accountsFlexGrid.itemsSource = accountsCollectionView;
                                accountsFlexGrid.trackChanges = true;
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#AccountsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveAccounts").prop("disabled", false);
                                $("#btnCloseAccounts").prop("disabled", false);
                            }
                        }
                    });
                } else {
                    $.ajax({
                        type: "PUT",
                        url: '/api/account/update/' + accountId,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: AccountsData,
                        statusCode: {
                            200: function () {
                                toastr.success("Update Successful");

                                $("#AccountsEditDetailModal").modal("hide");

                                accountsCollectionView = new wijmo.collections.CollectionView(getAccountsList());
                                accountsCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchAccounts').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    accountsCollectionView.refresh();
                                });

                                accountsCollectionView.filter = function (item) {
                                    return !filterText || (item.Account.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                accountsCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateAccountsStampSecurity();
                                });

                                // Flex Grid
                                accountsFlexGrid.itemsSource = accountsCollectionView;
                                accountsFlexGrid.trackChanges = true;
                            },
                            404: function () {
                                toastr.error("Not Found");

                                $("#AccountsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveAccounts").prop("disabled", false);
                                $("#btnCloseAccounts").prop("disabled", false);
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#AccountsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveAccounts").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveAccounts").prop("disabled", false);
                                $("#btnCloseAccounts").prop("disabled", false);
                            }
                        }
                    });
                }
            } else {
                toastr.error("Invalid Entry");
            }
        }

        // delete   Accounts
        function deleteAccountsOnclick() {
            $("#deleteConfirmationAccountsModal").modal({
                "show": true,
                "backdrop": "static"
            });

            document.getElementById("btnConfirmDeleteAccounts").innerHTML = "Delete";
            $("#btnConfirmDeleteAccounts").prop("disabled", false);
            $("#btnCloseDeleteAccountsModal").prop("disabled", false);
        }
        function btnConfirmDeleteAccountsOnclick() {
            document.getElementById("btnConfirmDeleteAccounts").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Deleting";
            $("#btnConfirmDeleteAccounts").prop("disabled", true);
            $("#btnCloseDeleteAccountsModal").prop("disabled", true);

            accountsCollectionView.editItem(accountsCollectionView.currentItem);
            var id = accountsCollectionView.currentEditItem.Id;
            $.ajax({
                url: '/api/account/delete/' + id,
                type: "DELETE",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                statusCode: {
                    200: function () {
                        toastr.success("Delete Successful");

                        $('#deleteConfirmationAccountsModal').modal('hide');

                        accountsCollectionView = new wijmo.collections.CollectionView(getAccountsList());
                        accountsCollectionView.canFilter = true;

                        var filterText = '';
                        $('#searchAccounts').keyup(function () {
                            filterText = this.value.toLowerCase();
                            accountsCollectionView.refresh();
                        });

                        accountsCollectionView.filter = function (item) {
                            return !filterText || (item.Account.toLowerCase().indexOf(filterText) > -1)
                                               || (item.Description.toLowerCase().indexOf(filterText) > -1);
                        }

                        accountsCollectionView.currentChanged.addHandler(function (sender, args) {
                            updateAccountsStampSecurity();
                        });

                        // Flex Grid
                        accountsFlexGrid.itemsSource = accountsCollectionView;
                        accountsFlexGrid.trackChanges = true;
                    },
                    404: function () {
                        toastr.error("Not Found");
                        $('#deleteConfirmationAccountsModal').modal('hide');
                        $("#btnConfirmDeleteAccounts").prop("disabled", false);
                        $("#btnCloseDeleteAccountsModal").prop("disabled", false);
                    },
                    400: function () {
                        toastr.error("Bad Request");
                        $('#deleteConfirmationAccountsModal').modal('hide');
                        $("#btnConfirmDeleteAccounts").prop("disabled", false);
                        $("#btnCloseDeleteAccountsModal").prop("disabled", false);
                    }
                }
            });
        }

        // stamp security
        function updateAccountsStampSecurity() {
            var item = accountsCollectionView.currentItem;
            document.getElementById('stampCreatedBy').innerHTML = item.CreatedByUser;
            document.getElementById('stampCreatedDate').innerHTML = item.CreatedDateTime;
            document.getElementById('stampUpdatedBy').innerHTML = item.UpdatedByUser;
            document.getElementById('stampUpdatedDate').innerHTML = item.UpdatedDateTime;
        }

        //   Accounts flexgrid
        function createAccountFlexGrid() {
            NProgress.start();
            toastrModification();

            accountsCollectionView = new wijmo.collections.CollectionView(getAccountsList());
            accountsCollectionView.canFilter = true;

            var filterText = '';
            $('#searchAccounts').keyup(function () {
                filterText = this.value.toLowerCase();
                accountsCollectionView.refresh();
            });

            accountsCollectionView.filter = function (item) {
                return !filterText || (item.Account.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            accountsCollectionView.currentChanged.addHandler(function (sender, args) {
                updateAccountsStampSecurity();
            });

            // Flex Grid
            accountsFlexGrid = new wijmo.grid.FlexGrid('#AccountsListFlexGrid');
            accountsFlexGrid.initialize({
                columns: [
                            {
                                "header": "Edit",
                                "binding": "EditButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Delete",
                                "binding": "DeleteButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Account",
                                "binding": "Account",
                                "allowSorting": true,
                                "width": "2.5*"
                            },
                            {
                                "header": "Description",
                                "binding": "Description",
                                "allowSorting": true,
                                "width": "3*"
                            },
                            {
                                "header": "Transaction",
                                "binding": "AccountTransactionType",
                                "allowSorting": true,
                                "width": "2*"
                            },
                ],
                autoGenerateColumns: false,
                itemsSource: accountsCollectionView,
                isReadOnly: true,
                autoSizeMode: wijmo.grid.AutoSizeMode.Both,
                allowDragging: wijmo.grid.AllowDragging.None,
                selectionMode: wijmo.grid.SelectionMode.Row
            });

            accountsFlexGrid.trackChanges = true;
        }

        //   Accounts tab
        $('#accountTab').click(function () {
            NProgress.start();
            $("#Requirements").hide();
            $("#Accounts").show();
            $("#ExpenseTypes").hide();
            $("#LoanTypes").hide();

            createAccountFlexGrid();
            window.createAccountFlexGrid = function () {
                return true;
            }

            accountsCollectionView = new wijmo.collections.CollectionView(getAccountsList());
            accountsCollectionView.canFilter = true;

            var filterText = '';
            $('#searchAccounts').keyup(function () {
                filterText = this.value.toLowerCase();
                accountsCollectionView.refresh();
            });

            accountsCollectionView.filter = function (item) {
                return !filterText || (item.Account.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            accountsCollectionView.currentChanged.addHandler(function (sender, args) {
                updateAccountsStampSecurity();
            });

            // Flex Grid
            accountsFlexGrid.itemsSource = accountsCollectionView;
            accountsFlexGrid.trackChanges = true;
        });

        // get Expense Types
        function getExpenseTypesList() {
            var expenseTypes = new wijmo.collections.ObservableArray;
            $.ajax({
                url: '/api/expenseType/list',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (expenseTypesListResult) {
                    if (expenseTypesListResult.length > 0) {
                        for (i = 0; i < expenseTypesListResult.length; i++) {

                            var disabledButton = "disabled";
                            var canPerformActions = "@ViewData["CanPerformActions"]";
                            if (canPerformActions == 1) {
                                disabledButton = "";
                            }

                            expenseTypes.push({
                                EditButton: "<button class='btn btn-primary btn-xs btn-block' onclick='editExpenseTypesOnclick()'" + disabledButton + "><i class='fa fa-edit fa-fw'></i> Edit</button>",
                                DeleteButton: "<button class='btn btn-danger btn-xs btn-block'  onclick='deleteExpenseTypesOnclick()'" + disabledButton + "><i class='fa fa-trash fa-fw'></i> Delete</button>",
                                Id: expenseTypesListResult[i]["Id"],
                                ExpenseType: expenseTypesListResult[i]["ExpenseType"],
                                Description: expenseTypesListResult[i]["Description"],
                                CreatedByUserId: expenseTypesListResult[i]["CreatedByUserId"],
                                CreatedByUser: expenseTypesListResult[i]["CreatedByUser"],
                                CreatedDateTime: expenseTypesListResult[i]["CreatedDateTime"],
                                UpdatedByUserId: expenseTypesListResult[i]["UpdatedByUserId"],
                                UpdatedByUser: expenseTypesListResult[i]["UpdatedByUser"],
                                UpdatedDateTime: expenseTypesListResult[i]["UpdatedDateTime"]
                            });
                        }
                    }

                    NProgress.done();
                }
            });
            return expenseTypes;
        }

        // add new Expense types
        function btnAddExpenseTypesOnclick() {
            $("#expenseTypeEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredExpenseTypes').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveExpenseTypes").prop("disabled", false);
            $("#btnCloseExpenseTypes").prop("disabled", false);

            expenseTypeId = 0;
            document.getElementById("expenseTypeName").value = "NA";
            document.getElementById("expenseTypeDescription").value = "NA";
        }

        // edit Expense Types
        function editExpenseTypesOnclick() {
            $("#expenseTypeEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredExpenseTypes').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveExpenseTypes").prop("disabled", false);
            $("#btnCloseExpenseTypes").prop("disabled", false);

            expenseTypesCollectionView.editItem(expenseTypesCollectionView.currentItem);
            var expenseTypeCurrentEditItem = expenseTypesCollectionView.currentEditItem;

            expenseTypeId = expenseTypeCurrentEditItem.Id;
            document.getElementById("expenseTypeName").value = expenseTypeCurrentEditItem.ExpenseType;
            document.getElementById("expenseTypeDescription").value = expenseTypeCurrentEditItem.Description;
        }

        // form input validation
        function inputValidationForExpenseTypes() {
            var isValid = true;
            $('.requiredExpenseTypes').each(function () {
                if ($.trim($(this).val()) == '') {
                    isValid = false;
                    $(this).css({
                        "border": "1px solid red"
                    });
                } else {
                    $(this).css({
                        "border": "",
                    });
                }
            });

            return isValid;
        }

        // save Expense Types
        function saveExpenseTypesOnclick() {
            if (inputValidationForExpenseTypes()) {
                document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Saving";
                $("#btnSaveExpenseTypes").prop("disabled", true);
                $("#btnCloseExpenseTypes").prop("disabled", true);

                var ExpenseTypesObject = new Object();
                ExpenseTypesObject.ExpenseType = document.getElementById('expenseTypeName').value;
                ExpenseTypesObject.Description = document.getElementById('expenseTypeDescription').value;
                var ExpenseTypesData = JSON.stringify(ExpenseTypesObject);

                if (expenseTypeId == 0) {
                    $.ajax({
                        type: "POST",
                        url: '/api/expenseType/add',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: ExpenseTypesData,
                        statusCode: {
                            200: function () {
                                toastr.success("Save Successful");

                                $("#expenseTypeEditDetailModal").modal("hide");

                                expenseTypesCollectionView = new wijmo.collections.CollectionView(getExpenseTypesList());
                                expenseTypesCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchExpenseTypes').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    expenseTypesCollectionView.refresh();
                                });

                                expenseTypesCollectionView.filter = function (item) {
                                    return !filterText || (item.ExpenseType.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                expenseTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateExpenseTypesStampSecurity();
                                });

                                // Flex Grid
                                expenseTypesFlexGrid.itemsSource = expenseTypesCollectionView;
                                expenseTypesFlexGrid.trackChanges = true;
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#expenseTypeEditDetailModal").modal("hide");

                                document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveExpenseTypes").prop("disabled", false);
                                $("#btnCloseExpenseTypes").prop("disabled", false);
                            }
                        }
                    });
                } else {
                    $.ajax({
                        type: "PUT",
                        url: '/api/expenseType/update/' + expenseTypeId,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: ExpenseTypesData,
                        statusCode: {
                            200: function () {
                                toastr.success("Update Successful");

                                $("#expenseTypeEditDetailModal").modal("hide");

                                expenseTypesCollectionView = new wijmo.collections.CollectionView(getExpenseTypesList());
                                expenseTypesCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchExpenseTypes').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    expenseTypesCollectionView.refresh();
                                });

                                expenseTypesCollectionView.filter = function (item) {
                                    return !filterText || (item.ExpenseType.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                expenseTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateExpenseTypesStampSecurity();
                                });

                                // Flex Grid
                                expenseTypesFlexGrid.itemsSource = expenseTypesCollectionView;
                                expenseTypesFlexGrid.trackChanges = true;
                            },
                            404: function () {
                                toastr.error("Not Found");

                                $("#expenseTypeEditDetailModal").modal("hide");

                                document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveExpenseTypes").prop("disabled", false);
                                $("#btnCloseExpenseTypes").prop("disabled", false);
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#expenseTypeEditDetailModal").modal("hide");

                                document.getElementById("btnSaveExpenseTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveExpenseTypes").prop("disabled", false);
                                $("#btnCloseExpenseTypes").prop("disabled", false);
                            }
                        }
                    });
                }
            } else {
                toastr.error("Invalid Entry");
            }
        }

        // delete Expense Types
        function deleteExpenseTypesOnclick() {
            $("#deleteConfirmationExpenseTypesModal").modal({
                "show": true,
                "backdrop": "static"
            });

            document.getElementById("btnConfirmDeleteExpenseTypes").innerHTML = "Delete";
            $("#btnConfirmDeleteExpenseTypes").prop("disabled", false);
            $("#btnCloseDeleteExpenseTypesModal").prop("disabled", false);
        }
        function btnConfirmDeleteExpenseTypesOnclick() {
            document.getElementById("btnConfirmDeleteExpenseTypes").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Deleting";
            $("#btnConfirmDeleteExpenseTypes").prop("disabled", true);
            $("#btnCloseDeleteExpenseTypesModal").prop("disabled", true);

            expenseTypesCollectionView.editItem(expenseTypesCollectionView.currentItem);
            var id = expenseTypesCollectionView.currentEditItem.Id;
            $.ajax({
                url: '/api/expenseType/delete/' + id,
                type: "DELETE",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                statusCode: {
                    200: function () {
                        toastr.success("Delete Successful");

                        $('#deleteConfirmationExpenseTypesModal').modal('hide');

                        expenseTypesCollectionView = new wijmo.collections.CollectionView(getExpenseTypesList());
                        expenseTypesCollectionView.canFilter = true;

                        var filterText = '';
                        $('#searchExpenseTypes').keyup(function () {
                            filterText = this.value.toLowerCase();
                            expenseTypesCollectionView.refresh();
                        });

                        expenseTypesCollectionView.filter = function (item) {
                            return !filterText || (item.ExpenseType.toLowerCase().indexOf(filterText) > -1)
                                               || (item.Description.toLowerCase().indexOf(filterText) > -1);
                        }

                        expenseTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                            updateExpenseTypesStampSecurity();
                        });

                        // Flex Grid
                        expenseTypesFlexGrid.itemsSource = expenseTypesCollectionView;
                        expenseTypesFlexGrid.trackChanges = true;
                    },
                    404: function () {
                        toastr.error("Not Found");
                        $('#deleteConfirmationExpenseTypesModal').modal('hide');
                        $("#btnConfirmDeleteExpenseTypes").prop("disabled", false);
                        $("#btnCloseDeleteExpenseTypesModal").prop("disabled", false);
                    },
                    400: function () {
                        toastr.error("Bad Request");
                        $('#deleteConfirmationExpenseTypesModal').modal('hide');
                        $("#btnConfirmDeleteExpenseTypes").prop("disabled", false);
                        $("#btnCloseDeleteExpenseTypesModal").prop("disabled", false);
                    }
                }
            });
        }

        // stamp security
        function updateExpenseTypesStampSecurity() {
            var item = expenseTypesCollectionView.currentItem;
            document.getElementById('stampCreatedBy').innerHTML = item.CreatedByUser;
            document.getElementById('stampCreatedDate').innerHTML = item.CreatedDateTime;
            document.getElementById('stampUpdatedBy').innerHTML = item.UpdatedByUser;
            document.getElementById('stampUpdatedDate').innerHTML = item.UpdatedDateTime;
        }

        // Expense Types flexgrid
        function createExpenseTypeFlexGrid() {
            NProgress.start();
            toastrModification();

            expenseTypesCollectionView = new wijmo.collections.CollectionView(getExpenseTypesList());
            expenseTypesCollectionView.canFilter = true;

            var filterText = '';
            $('#searchExpenseTypes').keyup(function () {
                filterText = this.value.toLowerCase();
                expenseTypesCollectionView.refresh();
            });

            expenseTypesCollectionView.filter = function (item) {
                return !filterText || (item.ExpenseType.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            expenseTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                updateExpenseTypesStampSecurity();
            });

            // Flex Grid
            expenseTypesFlexGrid = new wijmo.grid.FlexGrid('#ExpenseTypesListFlexGrid');
            expenseTypesFlexGrid.initialize({
                columns: [
                            {
                                "header": "Edit",
                                "binding": "EditButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Delete",
                                "binding": "DeleteButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "ExpenseType",
                                "binding": "ExpenseType",
                                "allowSorting": true,
                                "width": "2*"
                            },
                            {
                                "header": "Description",
                                "binding": "Description",
                                "allowSorting": true,
                                "width": "3*"
                            }
                ],
                autoGenerateColumns: false,
                itemsSource: expenseTypesCollectionView,
                isReadOnly: true,
                autoSizeMode: wijmo.grid.AutoSizeMode.Both,
                allowDragging: wijmo.grid.AllowDragging.None,
                selectionMode: wijmo.grid.SelectionMode.Row
            });

            expenseTypesFlexGrid.trackChanges = true;
        }

        // Expense Types tab
        $('#expenseTypesTab').click(function () {
            NProgress.start();
            $("#Requirements").hide();
            $("#Accounts").hide();
            $("#ExpenseTypes").show();
            $("#LoanTypes").hide();

            createExpenseTypeFlexGrid();
            window.createExpenseTypeFlexGrid = function () {
                return true;
            }

            expenseTypesCollectionView = new wijmo.collections.CollectionView(getExpenseTypesList());
            expenseTypesCollectionView.canFilter = true;

            var filterText = '';
            $('#searchExpenseTypes').keyup(function () {
                filterText = this.value.toLowerCase();
                expenseTypesCollectionView.refresh();
            });

            expenseTypesCollectionView.filter = function (item) {
                return !filterText || (item.ExpenseType.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            expenseTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                updateExpenseTypesStampSecurity();
            });

            // Flex Grid
            expenseTypesFlexGrid.itemsSource = expenseTypesCollectionView;
            expenseTypesFlexGrid.trackChanges = true;
        });

        // get Requirements
        function getRequirementsList() {
            var requirements = new wijmo.collections.ObservableArray;
            $.ajax({
                url: '/api/requirements/list',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (requirementsListResult) {
                    if (requirementsListResult.length > 0) {
                        for (i = 0; i < requirementsListResult.length; i++) {

                            var disabledButton = "disabled";
                            var canPerformActions = "@ViewData["CanPerformActions"]";
                            if (canPerformActions == 1) {
                                disabledButton = "";
                            }

                            requirements.push({
                                EditButton: "<button class='btn btn-primary btn-xs btn-block' onclick='editRequirementsOnclick()'" + disabledButton + "><i class='fa fa-edit fa-fw'></i> Edit</button>",
                                DeleteButton: "<button class='btn btn-danger btn-xs btn-block'  onclick='deleteRequirementsOnclick()'" + disabledButton + "><i class='fa fa-trash fa-fw'></i> Delete</button>",
                                Id: requirementsListResult[i]["Id"],
                                Requirement: requirementsListResult[i]["Requirement"],
                                Description: requirementsListResult[i]["Description"],
                                CreatedByUserId: requirementsListResult[i]["CreatedByUserId"],
                                CreatedByUser: requirementsListResult[i]["CreatedByUser"],
                                CreatedDateTime: requirementsListResult[i]["CreatedDateTime"],
                                UpdatedByUserId: requirementsListResult[i]["UpdatedByUserId"],
                                UpdatedByUser: requirementsListResult[i]["UpdatedByUser"],
                                UpdatedDateTime: requirementsListResult[i]["UpdatedDateTime"]
                            });
                        }
                    }

                    NProgress.done();
                }
            });
            return requirements;
        }

        // add new   Requirements
        function btnAddRequirementsOnclick() {
            $("#RequirementsEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredRequirements').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveRequirements").prop("disabled", false);
            $("#btnCloseRequirements").prop("disabled", false);

            requirementId = 0;
            document.getElementById("requirementName").value = "NA";
            document.getElementById("requirementDescription").value = "NA";
        }

        // edit   Requirements
        function editRequirementsOnclick() {
            $("#RequirementsEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredRequirements').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveRequirements").prop("disabled", false);
            $("#btnCloseRequirements").prop("disabled", false);

            requirementsCollectionView.editItem(requirementsCollectionView.currentItem);
            var requirementCurrentEditItem = requirementsCollectionView.currentEditItem;

            requirementId = requirementCurrentEditItem.Id;
            document.getElementById("requirementName").value = requirementCurrentEditItem.Requirement;
            document.getElementById("requirementDescription").value = requirementCurrentEditItem.Description;
        }

        // form input validation
        function inputValidationForRequirements() {
            var isValid = true;
            $('.requiredRequirements').each(function () {
                if ($.trim($(this).val()) == '') {
                    isValid = false;
                    $(this).css({
                        "border": "1px solid red"
                    });
                } else {
                    $(this).css({
                        "border": "",
                    });
                }
            });

            return isValid;
        }

        // save   Requirements
        function saveRequirementsOnclick() {
            if (inputValidationForRequirements()) {
                document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Saving";
                $("#btnSaveRequirements").prop("disabled", true);
                $("#btnCloseRequirements").prop("disabled", true);

                var RequirementsObject = new Object();
                RequirementsObject.Requirement = document.getElementById('requirementName').value;
                RequirementsObject.Description = document.getElementById('requirementDescription').value;
                var RequirementsData = JSON.stringify(RequirementsObject);

                if (requirementId == 0) {
                    $.ajax({
                        type: "POST",
                        url: '/api/Requirements/add',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: RequirementsData,
                        statusCode: {
                            200: function () {
                                toastr.success("Save Successful");

                                $("#RequirementsEditDetailModal").modal("hide");

                                requirementsCollectionView = new wijmo.collections.CollectionView(getRequirementsList());
                                requirementsCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchRequirements').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    requirementsCollectionView.refresh();
                                });

                                requirementsCollectionView.filter = function (item) {
                                    return !filterText || (item.Requirement.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                requirementsCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateRequirementsStampSecurity();
                                });

                                // Flex Grid
                                requirementsFlexGrid.itemsSource = requirementsCollectionView;
                                requirementsFlexGrid.trackChanges = true;
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#RequirementsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveRequirements").prop("disabled", false);
                                $("#btnCloseRequirements").prop("disabled", false);
                            }
                        }
                    });
                } else {
                    $.ajax({
                        type: "PUT",
                        url: '/api/Requirements/update/' + requirementId,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: RequirementsData,
                        statusCode: {
                            200: function () {
                                toastr.success("Update Successful");

                                $("#RequirementsEditDetailModal").modal("hide");

                                requirementsCollectionView = new wijmo.collections.CollectionView(getRequirementsList());
                                requirementsCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchRequirements').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    requirementsCollectionView.refresh();
                                });

                                requirementsCollectionView.filter = function (item) {
                                    return !filterText || (item.Requirement.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                requirementsCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateRequirementsStampSecurity();
                                });

                                // Flex Grid
                                requirementsFlexGrid.itemsSource = requirementsCollectionView;
                                requirementsFlexGrid.trackChanges = true;
                            },
                            404: function () {
                                toastr.error("Not Found");

                                $("#RequirementsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveRequirements").prop("disabled", false);
                                $("#btnCloseRequirements").prop("disabled", false);
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#RequirementsEditDetailModal").modal("hide");

                                document.getElementById("btnSaveRequirements").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveRequirements").prop("disabled", false);
                                $("#btnCloseRequirements").prop("disabled", false);
                            }
                        }
                    });
                }
            } else {
                toastr.error("Invalid Entry");
            }
        }

        // delete   Requirements
        function deleteRequirementsOnclick() {
            $("#deleteConfirmationRequirementsModal").modal({
                "show": true,
                "backdrop": "static"
            });

            document.getElementById("btnConfirmDeleteRequirements").innerHTML = "Delete";
            $("#btnConfirmDeleteRequirements").prop("disabled", false);
            $("#btnCloseDeleteRequirementsModal").prop("disabled", false);
        }
        function btnConfirmDeleteRequirementsOnclick() {
            document.getElementById("btnConfirmDeleteRequirements").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Deleting";
            $("#btnConfirmDeleteRequirements").prop("disabled", true);
            $("#btnCloseDeleteRequirementsModal").prop("disabled", true);

            requirementsCollectionView.editItem(requirementsCollectionView.currentItem);
            var id = requirementsCollectionView.currentEditItem.Id;
            $.ajax({
                url: '/api/Requirements/delete/' + id,
                type: "DELETE",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                statusCode: {
                    200: function () {
                        toastr.success("Delete Successful");

                        $('#deleteConfirmationRequirementsModal').modal('hide');

                        requirementsCollectionView = new wijmo.collections.CollectionView(getRequirementsList());
                        requirementsCollectionView.canFilter = true;

                        var filterText = '';
                        $('#searchRequirements').keyup(function () {
                            filterText = this.value.toLowerCase();
                            requirementsCollectionView.refresh();
                        });

                        requirementsCollectionView.filter = function (item) {
                            return !filterText || (item.Requirement.toLowerCase().indexOf(filterText) > -1)
                                               || (item.Description.toLowerCase().indexOf(filterText) > -1);
                        }

                        requirementsCollectionView.currentChanged.addHandler(function (sender, args) {
                            updateRequirementsStampSecurity();
                        });

                        // Flex Grid
                        requirementsFlexGrid.itemsSource = requirementsCollectionView;
                        requirementsFlexGrid.trackChanges = true;
                    },
                    404: function () {
                        toastr.error("Not Found");
                        $('#deleteConfirmationRequirementsModal').modal('hide');
                        $("#btnConfirmDeleteRequirements").prop("disabled", false);
                        $("#btnCloseDeleteRequirementsModal").prop("disabled", false);
                    },
                    400: function () {
                        toastr.error("Bad Request");
                        $('#deleteConfirmationRequirementsModal').modal('hide');
                        $("#btnConfirmDeleteRequirements").prop("disabled", false);
                        $("#btnCloseDeleteRequirementsModal").prop("disabled", false);
                    }
                }
            });
        }

        // stamp security
        function updateRequirementsStampSecurity() {
            var item = requirementsCollectionView.currentItem;
            document.getElementById('stampCreatedBy').innerHTML = item.CreatedByUser;
            document.getElementById('stampCreatedDate').innerHTML = item.CreatedDateTime;
            document.getElementById('stampUpdatedBy').innerHTML = item.UpdatedByUser;
            document.getElementById('stampUpdatedDate').innerHTML = item.UpdatedDateTime;
        }

        //   Requirements flexgrid
        function createRequirementFlexGrid() {
            NProgress.start();
            toastrModification();

            requirementsCollectionView = new wijmo.collections.CollectionView(getRequirementsList());
            requirementsCollectionView.canFilter = true;

            var filterText = '';
            $('#searchRequirements').keyup(function () {
                filterText = this.value.toLowerCase();
                requirementsCollectionView.refresh();
            });

            requirementsCollectionView.filter = function (item) {
                return !filterText || (item.Requirement.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            requirementsCollectionView.currentChanged.addHandler(function (sender, args) {
                updateRequirementsStampSecurity();
            });

            // Flex Grid
            requirementsFlexGrid = new wijmo.grid.FlexGrid('#RequirementsListFlexGrid');
            requirementsFlexGrid.initialize({
                columns: [
                            {
                                "header": "Edit",
                                "binding": "EditButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Delete",
                                "binding": "DeleteButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Requirement",
                                "binding": "Requirement",
                                "allowSorting": true,
                                "width": "2*"
                            },
                            {
                                "header": "Description",
                                "binding": "Description",
                                "allowSorting": true,
                                "width": "3*"
                            }
                ],
                autoGenerateColumns: false,
                itemsSource: requirementsCollectionView,
                isReadOnly: true,
                autoSizeMode: wijmo.grid.AutoSizeMode.Both,
                allowDragging: wijmo.grid.AllowDragging.None,
                selectionMode: wijmo.grid.SelectionMode.Row
            });

            requirementsFlexGrid.trackChanges = true;
        }

        //   Requirements tab
        $('#RequirementsTab').click(function () {
            NProgress.start();
            $("#Requirements").show();
            $("#Accounts").hide();
            $("#ExpenseTypes").hide();
            $("#LoanTypes").hide();

            createRequirementFlexGrid();
            window.createRequirementFlexGrid = function () {
                return true;
            }

            requirementsCollectionView = new wijmo.collections.CollectionView(getRequirementsList());
            requirementsCollectionView.canFilter = true;

            var filterText = '';
            $('#searchRequirements').keyup(function () {
                filterText = this.value.toLowerCase();
                requirementsCollectionView.refresh();
            });

            requirementsCollectionView.filter = function (item) {
                return !filterText || (item.Requirement.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            requirementsCollectionView.currentChanged.addHandler(function (sender, args) {
                updateRequirementsStampSecurity();
            });

            // Flex Grid
            requirementsFlexGrid.itemsSource = requirementsCollectionView;
            requirementsFlexGrid.trackChanges = true;
        });

        // get Loan Types
        function getLoanTypesList() {
            var loanTypes = new wijmo.collections.ObservableArray;
            $.ajax({
                url: '/api/loanTypes/list',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (loanTypesListResult) {
                    if (loanTypesListResult.length > 0) {
                        for (i = 0; i < loanTypesListResult.length; i++) {

                            var disabledButton = "disabled";
                            var canPerformActions = "@ViewData["CanPerformActions"]";
                            if (canPerformActions == 1) {
                                disabledButton = "";
                            }

                            loanTypes.push({
                                EditButton: "<button class='btn btn-primary btn-xs btn-block' onclick='editLoanTypesOnclick()'" + disabledButton + "><i class='fa fa-edit fa-fw'></i> Edit</button>",
                                DeleteButton: "<button class='btn btn-danger btn-xs btn-block'  onclick='deleteLoanTypesOnclick()'" + disabledButton + "><i class='fa fa-trash fa-fw'></i> Delete</button>",
                                Id: loanTypesListResult[i]["Id"],
                                LoanType: loanTypesListResult[i]["LoanType"],
                                Description: loanTypesListResult[i]["Description"],
                                CreatedByUserId: loanTypesListResult[i]["CreatedByUserId"],
                                CreatedByUser: loanTypesListResult[i]["CreatedByUser"],
                                CreatedDateTime: loanTypesListResult[i]["CreatedDateTime"],
                                UpdatedByUserId: loanTypesListResult[i]["UpdatedByUserId"],
                                UpdatedByUser: loanTypesListResult[i]["UpdatedByUser"],
                                UpdatedDateTime: loanTypesListResult[i]["UpdatedDateTime"]
                            });
                        }
                    }

                    NProgress.done();
                }
            });
            return loanTypes;
        }

        // add new Loan Types
        function btnAddLoanTypesOnclick() {
            $("#LoanTypesEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredLoanTypes').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveLoanTypes").prop("disabled", false);
            $("#btnCloseLoanTypes").prop("disabled", false);

            loanTypeId = 0;
            document.getElementById("loanTypeName").value = "NA";
            document.getElementById("loanTypeDescription").value = "NA";
        }

        // edit Loan Types
        function editLoanTypesOnclick() {
            $("#LoanTypesEditDetailModal").modal({
                "show": true,
                "backdrop": "static"
            });

            $('.requiredLoanTypes').each(function () {
                $(this).css({
                    "border": "",
                });
            });

            document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
            $("#btnSaveLoanTypes").prop("disabled", false);
            $("#btnCloseLoanTypes").prop("disabled", false);

            loanTypesCollectionView.editItem(loanTypesCollectionView.currentItem);
            var loanTypeCurrentEditItem = loanTypesCollectionView.currentEditItem;

            loanTypeId = loanTypeCurrentEditItem.Id;
            document.getElementById("loanTypeName").value = loanTypeCurrentEditItem.LoanType;
            document.getElementById("loanTypeDescription").value = loanTypeCurrentEditItem.Description;
        }

        // form input validation
        function inputValidationForLoanTypes() {
            var isValid = true;
            $('.requiredLoanTypes').each(function () {
                if ($.trim($(this).val()) == '') {
                    isValid = false;
                    $(this).css({
                        "border": "1px solid red"
                    });
                } else {
                    $(this).css({
                        "border": "",
                    });
                }
            });

            return isValid;
        }

        // save Loan Types
        function saveLoanTypesOnclick() {
            if (inputValidationForLoanTypes()) {
                document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Saving";
                $("#btnSaveLoanTypes").prop("disabled", true);
                $("#btnCloseLoanTypes").prop("disabled", true);

                var LoanTypesObject = new Object();
                LoanTypesObject.LoanType = document.getElementById('loanTypeName').value;
                LoanTypesObject.Description = document.getElementById('loanTypeDescription').value;
                var LoanTypesData = JSON.stringify(LoanTypesObject);

                if (loanTypeId == 0) {
                    $.ajax({
                        type: "POST",
                        url: '/api/LoanTypes/add',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: LoanTypesData,
                        statusCode: {
                            200: function () {
                                toastr.success("Save Successful");

                                $("#LoanTypesEditDetailModal").modal("hide");

                                loanTypesCollectionView = new wijmo.collections.CollectionView(getLoanTypesList());
                                loanTypesCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchLoanTypes').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    loanTypesCollectionView.refresh();
                                });

                                loanTypesCollectionView.filter = function (item) {
                                    return !filterText || (item.LoanType.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                loanTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateLoanTypesStampSecurity();
                                });

                                // Flex Grid
                                loanTypesFlexGrid.itemsSource = loanTypesCollectionView;
                                loanTypesFlexGrid.trackChanges = true;
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#LoanTypesEditDetailModal").modal("hide");

                                document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveLoanTypes").prop("disabled", false);
                                $("#btnCloseLoanTypes").prop("disabled", false);
                            }
                        }
                    });
                } else {
                    $.ajax({
                        type: "PUT",
                        url: '/api/LoanTypes/update/' + loanTypeId,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: LoanTypesData,
                        statusCode: {
                            200: function () {
                                toastr.success("Update Successful");

                                $("#LoanTypesEditDetailModal").modal("hide");

                                loanTypesCollectionView = new wijmo.collections.CollectionView(getLoanTypesList());
                                loanTypesCollectionView.canFilter = true;

                                var filterText = '';
                                $('#searchLoanTypes').keyup(function () {
                                    filterText = this.value.toLowerCase();
                                    loanTypesCollectionView.refresh();
                                });

                                loanTypesCollectionView.filter = function (item) {
                                    return !filterText || (item.LoanType.toLowerCase().indexOf(filterText) > -1)
                                                       || (item.Description.toLowerCase().indexOf(filterText) > -1);
                                }

                                loanTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                                    updateLoanTypesStampSecurity();
                                });

                                // Flex Grid
                                loanTypesFlexGrid.itemsSource = loanTypesCollectionView;
                                loanTypesFlexGrid.trackChanges = true;
                            },
                            404: function () {
                                toastr.error("Not Found");

                                $("#LoanTypesEditDetailModal").modal("hide");

                                document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveLoanTypes").prop("disabled", false);
                                $("#btnCloseLoanTypes").prop("disabled", false);
                            },
                            400: function () {
                                toastr.error("Bad Request");

                                $("#LoanTypesEditDetailModal").modal("hide");

                                document.getElementById("btnSaveLoanTypes").innerHTML = "<i class='fa fa-save fa-fw'></i> Save";
                                $("#btnSaveLoanTypes").prop("disabled", false);
                                $("#btnCloseLoanTypes").prop("disabled", false);
                            }
                        }
                    });
                }
            } else {
                toastr.error("Invalid Entry");
            }
        }

        // delete Loan Types
        function deleteLoanTypesOnclick() {
            $("#deleteConfirmationLoanTypesModal").modal({
                "show": true,
                "backdrop": "static"
            });

            document.getElementById("btnConfirmDeleteLoanTypes").innerHTML = "Delete";
            $("#btnConfirmDeleteLoanTypes").prop("disabled", false);
            $("#btnCloseDeleteLoanTypesModal").prop("disabled", false);
        }
        function btnConfirmDeleteLoanTypesOnclick() {
            document.getElementById("btnConfirmDeleteLoanTypes").innerHTML = "<i class='fa fa-spinner fa-spin fa-fw'></i> Deleting";
            $("#btnConfirmDeleteLoanTypes").prop("disabled", true);
            $("#btnCloseDeleteLoanTypesModal").prop("disabled", true);

            loanTypesCollectionView.editItem(loanTypesCollectionView.currentItem);
            var id = loanTypesCollectionView.currentEditItem.Id;
            $.ajax({
                url: '/api/LoanTypes/delete/' + id,
                type: "DELETE",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                statusCode: {
                    200: function () {
                        toastr.success("Delete Successful");

                        $('#deleteConfirmationLoanTypesModal').modal('hide');

                        loanTypesCollectionView = new wijmo.collections.CollectionView(getLoanTypesList());
                        loanTypesCollectionView.canFilter = true;

                        var filterText = '';
                        $('#searchLoanTypes').keyup(function () {
                            filterText = this.value.toLowerCase();
                            loanTypesCollectionView.refresh();
                        });

                        loanTypesCollectionView.filter = function (item) {
                            return !filterText || (item.LoanType.toLowerCase().indexOf(filterText) > -1)
                                               || (item.Description.toLowerCase().indexOf(filterText) > -1);
                        }

                        loanTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                            updateLoanTypesStampSecurity();
                        });

                        // Flex Grid
                        loanTypesFlexGrid.itemsSource = loanTypesCollectionView;
                        loanTypesFlexGrid.trackChanges = true;
                    },
                    404: function () {
                        toastr.error("Not Found");
                        $('#deleteConfirmationLoanTypesModal').modal('hide');
                        $("#btnConfirmDeleteLoanTypes").prop("disabled", false);
                        $("#btnCloseDeleteLoanTypesModal").prop("disabled", false);
                    },
                    400: function () {
                        toastr.error("Bad Request");
                        $('#deleteConfirmationLoanTypesModal').modal('hide');
                        $("#btnConfirmDeleteLoanTypes").prop("disabled", false);
                        $("#btnCloseDeleteLoanTypesModal").prop("disabled", false);
                    }
                }
            });
        }

        // stamp security
        function updateLoanTypesStampSecurity() {
            var item = loanTypesCollectionView.currentItem;
            document.getElementById('stampCreatedBy').innerHTML = item.CreatedByUser;
            document.getElementById('stampCreatedDate').innerHTML = item.CreatedDateTime;
            document.getElementById('stampUpdatedBy').innerHTML = item.UpdatedByUser;
            document.getElementById('stampUpdatedDate').innerHTML = item.UpdatedDateTime;
        }

        //  Loan Types flexgrid
        function createLoanTypeFlexGrid() {
            NProgress.start();
            toastrModification();

            loanTypesCollectionView = new wijmo.collections.CollectionView(getLoanTypesList());
            loanTypesCollectionView.canFilter = true;

            var filterText = '';
            $('#searchLoanTypes').keyup(function () {
                filterText = this.value.toLowerCase();
                loanTypesCollectionView.refresh();
            });

            loanTypesCollectionView.filter = function (item) {
                return !filterText || (item.LoanType.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            loanTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                updateLoanTypesStampSecurity();
            });

            // Flex Grid
            loanTypesFlexGrid = new wijmo.grid.FlexGrid('#LoanTypesListFlexGrid');
            loanTypesFlexGrid.initialize({
                columns: [
                            {
                                "header": "Edit",
                                "binding": "EditButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "Delete",
                                "binding": "DeleteButton",
                                "width": 80,
                                "align": "center",
                                "allowResizing": false,
                                "isContentHtml": true
                            },
                            {
                                "header": "LoanType",
                                "binding": "LoanType",
                                "allowSorting": true,
                                "width": "2*"
                            },
                            {
                                "header": "Description",
                                "binding": "Description",
                                "allowSorting": true,
                                "width": "3*"
                            }
                ],
                autoGenerateColumns: false,
                itemsSource: loanTypesCollectionView,
                isReadOnly: true,
                autoSizeMode: wijmo.grid.AutoSizeMode.Both,
                allowDragging: wijmo.grid.AllowDragging.None,
                selectionMode: wijmo.grid.SelectionMode.Row
            });

            loanTypesFlexGrid.trackChanges = true;
        }

        // Loan Types tab
        $('#LoanTypesTab').click(function () {
            NProgress.start();
            $("#Requirements").hide();
            $("#Accounts").hide();
            $("#ExpenseTypes").hide();
            $("#LoanTypes").show();

            loanTypesCollectionView = new wijmo.collections.CollectionView(getLoanTypesList());
            loanTypesCollectionView.canFilter = true;

            var filterText = '';
            $('#searchLoanTypes').keyup(function () {
                filterText = this.value.toLowerCase();
                loanTypesCollectionView.refresh();
            });

            loanTypesCollectionView.filter = function (item) {
                return !filterText || (item.LoanType.toLowerCase().indexOf(filterText) > -1)
                                   || (item.Description.toLowerCase().indexOf(filterText) > -1);
            }

            loanTypesCollectionView.currentChanged.addHandler(function (sender, args) {
                updateLoanTypesStampSecurity();
            });

            // Flex Grid
            loanTypesFlexGrid.itemsSource = loanTypesCollectionView;
            loanTypesFlexGrid.trackChanges = true;
        });

        // ready function
        window.onload = function () {
            NProgress.start();
            toastrModification();
            createLoanTypeFlexGrid();

            cboTransactionType = new wijmo.input.ComboBox('#transactionType');
            getTransactionType();

            var canPerformActions = "@ViewData["CanPerformActions"]";
            if (canPerformActions == 1) {
                $('#btnClose').prop('disabled', false);
            } else {
                $(':button').prop('disabled', true);
                $('#btnClose').prop('disabled', false);
                getUserRightsMessageError();
            }
        }
    </script>
</body>
</html>